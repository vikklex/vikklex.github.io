<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Elf and Trolls</title>
  <meta name="description" content="Elf and Trolls game">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="stylesheet" href="css/main.css">
</head>
<header>
  <div class="mainmenu">
    <ul class="mainmenu__list">
      <li class="mainmenu__link_1"><a href="#game">Game üêí</a></li>
      <li class="mainmenu__link_2"><a href="#results">Results üìî</a></li>
    </ul>
</header>
    </div>
<main id="main">
  <div id="results">
    <ol id="table"></ol>
  </div>
</main>
  <script src="js/router.js"></script>
  <script src="js/input.js"></script>
  <script src="js/resources.js"></script>
  <script src="js/sprite.js"></script>
  <script src="js/results.js"></script>
  <script src="js/main.js"></script>

  <script>
    let game = new Game(saveResult);

    const onRenderGame = () => { // 
      removeAll(); // —É–¥–∞–ª—è–µ–º –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ game –¥–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏

      let main = document.getElementById("main");

      let game = document.createElement("div"); // –∞ –∑–∞—Ç–µ–º –≤ —ç—Ç–æ–º –±–ª–æ–∫–µ —Å–Ω–æ–≤–∞ —Å–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã, —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ç–æ—Ä—ã—Ö —É–¥–∞–ª–∏–ª–∏

      game.setAttribute("id", "game");

      let area = document.createElement("canvas");

      area.setAttribute("id", "area");

      game.appendChild(area);
      main.appendChild(game);
    }

    const onStartGame = () => {
      game.start(); //=> contoller.start() => model.start()
    };

    const onStopGame = () => {
      game.stop(); //=> contoller.stop() => resourses.remove()
    };

    const onRenderResults = () => { //–ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      removeAll();

      let main = document.getElementById("main");

      let results = document.createElement("div");

      results.setAttribute("id", "results");

      let ol = document.createElement("ol");

      ol.setAttribute("id", "table");

      results.appendChild(ol);
      main.appendChild(results);
    }

    const onStartResults = () => {
      showResults();
    };

    const onStopResults = () => {
    };

    const removeAll = () => {
      let oldGame = document.getElementById("game");

      if (oldGame) { // —É–¥–∞–ª–∏—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—É—é –∏–≥—Ä—É
        oldGame.remove();
      } 

      let oldResults = document.getElementById("results");

      if (oldResults) {
        oldResults.remove(); // –≤–∏–∑—É–∞–ª—å–Ω–æ —É–¥–≤–ª–∏—Ç—å —Ä–µ—É–ª—å—Ç–∞—Ç—ã –∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ –∏–≥—Ä–µ
      }
    }

    let router = new Router();

    window.onpopstate = (event) => { // —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞, —Ç–æ –µ—Å—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ—â–µ–ª–∫–∏–≤–∞–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
      router.setPath(location.href);
    };

    router.handle("#game", onRenderGame, onStartGame, onStopGame, true);
    router.handle("#results", onRenderResults, onStartResults, onStopResults);
  </script>
</body>

</html>